<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas - panorama</title>
    <script>
        /*
        [기본 애니메이션 단계]
        1. 캔버스를 비웁니다.
           그리려는 도형이 (배경 이미지를 만들 때처럼) 캔버스를 가득 채우는 것이 아니라면, 이전에 그려진 모든 도형을 지울 필요가 있습니다. 
           가장 쉬운 방법은 clearRect() 메소드를 사용하는 것입니다.
        2. 캔버스 상태를 저장합니다.
           캔버스 상태에 영향을 주는 (스타일 변경, 모양 변형 등의) 설정값을 바꾸려고 하고, 
           바뀐 값을 각 장면마다 사용하려고 한다면, 원래 상태를 저장할 필요가 있습니다.
        3. 애니메이션할 도형을 그립니다.
           실제 장면을 그리는 단계입니다.
        4. 캔버스 상태를 복원합니다.
           새로운 장면을 그리기 전에 저장된 상태를 복원합니다.        
        */

        var img = new Image();

        // 변수
        // 스크롤될 이미지, 방향, 속도를 바꾸려면 변수값을 바꾼다.

        img.src = 'images/Capitan_Meadows,_Yosemite_National_Park.jpg';
        var CanvasXSize = 800;
        var CanvasYSize = 200;
        var speed = 30; // 값이 작을 수록 빨라진다
        var scale = 1.05;
        var y = -4.5; // 수직 옵셋

        // 주요 프로그램

        var dx = 0.75;
        var imgW;
        var imgH;
        var x = 0;
        var clearX;
        var clearY;
        var ctx;

        img.onload = function() {
            imgW = img.width*scale;
            imgH = img.height*scale;
            if (imgW > CanvasXSize) { x = CanvasXSize-imgW; } // 캔버스보다 큰 이미지
            if (imgW > CanvasXSize) { clearX = imgW; } // 캔버스보다 큰 이미지
            else { clearX = CanvasXSize; }
            if (imgH > CanvasYSize) { clearY = imgH; } // 캔버스보다 큰 이미지
            else { clearY = CanvasYSize; }
            // 캔버스 요소 얻기
            ctx = document.getElementById('canvas').getContext('2d');
            // 새로 그리기 속도 설정
            return setInterval(draw, speed);
        }

        function draw() {
            // 캔버스를 비운다
            ctx.clearRect(0,0,clearX,clearY);
            // 이미지가 캔버스보다 작거나 같다면 (If image is <= Canvas Size)
            if (imgW <= CanvasXSize) {
                // 재설정, 처음부터 시작
                if (x > (CanvasXSize)) { x = 0; }
                // 추가 이미지 그리기
                if (x > (CanvasXSize-imgW)) { ctx.drawImage(img,x-CanvasXSize+1,y,imgW,imgH); }
            }
            // 이미지가 캔버스보다 크다면 (If image is > Canvas Size)
            else {
                // 재설정, 처음부터 시작
                if (x > (CanvasXSize)) { x = CanvasXSize-imgW; }
                // 추가 이미지 그리기
                if (x > (CanvasXSize-imgW)) { ctx.drawImage(img,x-imgW+1,y,imgW,imgH); }
            }
            // 이미지 그리기
            ctx.drawImage(img,x,y,imgW,imgH);
            // 움직임 정도
            x += dx;
        }
    </script>
</head>
<body>
    <canvas id="canvas" width="800" height="200"></canvas>   
</body>
</html>